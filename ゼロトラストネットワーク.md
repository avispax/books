# ゼロトラストネットワーク -境界防御の限界を超えるためのセキュアなシステム設計 Evan Gilman 304p_4873118883.pdf

## 0. はじめに

本書では、一連のデザインパターンや考慮事項を取り上げている。

デザインパターンや考慮事項をまとめたのがゼロトラストモデルと呼ばれるものである。  
このモデルを導入すれば、横断的侵害、VPN の問題、一元的なファイアウォールの管理の負担が実質的に取り除かれる。

### 0.1. 本書の対象読者

ネットワークエンジニア、セキュリティエンジニア、CTO、そしてそれ以外のすべての人が、ゼロトラストを学ぶことから恩恵を受ける。

### 0.2. 本書を執筆した理由

本書の目的は、通信ネットワークを信頼しないシステムモデルを定義することにある。  
特定のソフトウェアや実装に焦点を合わせるのではなく、ゼロトラストネットワークを構築するための概念や原理を取り上げる。  
独自のシステムを構築するときに、この種のシステムを構築する方法が明確にイメージできるようになることを願っている。  
さらに、本書で説明する問題への再利用可能なソリューションも提供したいと考えている。

参考 : Google の[BeyondCorp](https://cloud.google.com/beyondcorp?hl=ja)

### 0.3. 現在のゼロトラストネットワーク

ゼロトラストモデルは Forrester の John Kindervag によって 2010 年に考案された。

現在のゼロトラストネットワークは、市販のソフトウェアコンポーネントと、それらのコンポーネントを斬新な方法で統合するカスタムソフトウェアとグルー(接着剤)を使って構築されている。  
本書を読むときには、ゼロトラストネットワークの実装が(まだ)ハードウェア製品やソフトウェア製品のインストールと設定のような簡単なものではないことに注意してほしい。

## 1. ゼロトラストの基礎

データセンター内のシステムやトラフィックは信頼できるという前提は間違っている。  
ホストやリンクが 1 つでも不正に侵入されれば、「セキュア」なインフラストラクチャ内を自由に移動することがいとも簡単にできてしまう。

ネットワークに信頼を置かなくても、ネットワーク通信を効率的にセキュアにすることは可能だ。

### 1.1. ゼロトラストネットワークとは何か

5 つの基本的な原則がある。

- ネットワークは常に安全ではないと見なされる。
- ネットワーク上には外部および内部の脅威が常に存在する。
- ネットワークを信用できると判断するには、ローカルネットワークでは不十分である。
- デバイス、ユーザー、ネットワークフローは 1 つ残らず認証および認可される。
- ポリシーは動的であり、できるだけ多くの情報源に基づいて作成されなければならない。

従来のネットワークセキュリティアーキテクチャは、ネットワーク(またはサブネット)をゾーンに分割し、1 つ以上のファイアウォールで侵入を食い止めている。（図 1-1）  
各ゾーンには何らかの信頼レベルが割り当てられ、それにより、どのネットワークリソースヘのアクセスが許可されるのかが決まる。  
このモデルは非常に強力な多層防御をもたらす。

ただし、現代のサイバー攻撃には力不足である。

アクセス制御の適用箇所(ポリシーエンフォースメント)を分散させ、ゼロトラストの原則を適用すると、図 1-2 のような設計が可能となる。

#### 1.1.1. ゼロトラストコントロールプレーン

サポーティングシステムは**コントロールプレーン(control plane)**と呼ばれる。  
それ以外のほとんどのものは**データプレーン(data plane)**と呼ばれ、コントロールプレーンによって管理される。  
保護されているリソースヘのアクセスリクエストは、まずコントロールプレーンに送信される。  
コントロールプレーンでは、デバイスとユーザーの両方が認証および認可されなければならない。

コントロールプレーンは、「リクエストを許可できる」と判断すると、送信元のクライアントからのトラフイック(のみ)を受け入れるようにデータプレーンを動的に設定する。

適用したいアクセス制御の強度について、信用できるデータプレーンに対し、さまざまな入力に基づいて認証、認可、アクセスをリアルタイムに調整する権限を与える、というのが基本的な考え方である。

### 1.2. 境界モデルの進化

従来のアーキテクチャは**境界モデル(perimeter model)**と呼ばれる。  
侵入者は、境界線を突破しなければデータにアクセスできない。  
残念ながら、近年の環境では、もはや十分ではない。  
以下、歴史。

- 最初期はグローバル IP のみだった。（1.2.1. グローバル IP アドレス空間の管理）
- グローバルだけだとあれなので、プライベート IP アドレスが誕生した。セキュリティはまだなかった。（1.2.2. プライベー卜 IP アドレス空間の誕生）
- 外部とのやり取り用にメールサーバーぐらいが配置された。境界モデルの誕生である。（1.2.3. プライベートネットワークからパブリックネットワークヘの接続）
- メールだけだとあれで、NAT が活用された。実質ファイアウォール。（1.2.4. NAT の誕生）
- 境界となる場所を厳重にセキュリティ制御しよう。（1.2.5. 現代の境界モデル）

### 1.3. 潜在的な脅威の進化

NAT は内から外に行く分には緩いので、マルウェアによる攻撃が主流となった。  
境界の内側に潜り込めたら横断的侵害はチョロい。

### 1.4. 境界モデルの弱点

マルウェアによる横断的侵害の実例。

ネットワークセキュリティに関して考えられる最善のモデルは 信用 である。

### 1.5. 信用の在りか

ゼロトラストモデルは、その名のとおり、ネットワークを盲目的に信頼しないモデルである。

ホストが属しているネットワークは危険にさらされており、安全ではないと見なさなければならない。

### 1.6. 成功要因としての自動化

セキュリティポリシーを動的に更新して適用することが必要なので、自動化が必須となる。

### 1.7. 境界とゼロトラスト

境界モデルとゼロトラストモデルは根本的に異なっている。  
境界モデルは、信頼されるリソースと信頼されないリソース(言い換えれば、ローカルネットワークとインターネット)の間に壁を築こうとする。  
これに対し、ゼロトラストモデルは基本的に負けを認め、「悪人」はどこにでもいるという現実を受け入れる。

ゼロトラストネットワークは、以下の 3 つの重要な要素で構成される。

- ユーザー/アプリケーション認証  
   すべてのアクションがユーザーによって実行されるわけではないため、二重性を示している。  
   (データセンターの内部など)自動化されたアクションの場合は、普段ユーザーの属性を調べるのと同じような方法で、アプリケーションの属性を調べることになる。

- デバイス認証
- 信用

補足 : 上の 3 つは後の章で詳解される。

境界モデルの欠点は、全体的な保護に欠けていることにある。

ゼロトラストモデルは、セキュリテイを強化すればするほど、利便性が高くなる。

### 1.8. クラウドヘの適用

ゼロトラストはクラウド環境に最適である。  
パブリッククラウド内のネットワークは信頼できないからだ。

### 1.9. まとめ

本章では、ゼロトラストモデルの概念を取り上げた。
次章では、信用を安全に管理するシステムを構築するために理解しておくべき上位の概念について説明する。

## 2. 信頼と信用の管理

信頼と信用の管理はゼロトラストネットワークの最も重要な構成要素である。

信頼、信用とはなにか。けっきょく、私（運用者が）その人を知ってる/知らない だ。

ゼロトラストネットワークでの信頼は常に運用者から始まる。

信頼にお墨付きを与え、信頼を付与する運用者が常に勤務中とは限らない。

信頼されている運用者がシステムにある程度の信頼を割り当て、そのシステムが自動で行った作業を信用する。（信用の委任）

オートスケーリングはその一例である。  
サーバーを必要に応じて自動的に構築したいが、新しいサーバーが、他の適当に立てられた管理されないサーバーではないことはどうすればわかるか。  
構築システムを自作するのだ。それで自作されたサーバーはつまり自分のやつだ。

このような流れはトラストチェーン(trust chain)と呼ばれる。  
そして、運用者をトラストアンカーと呼ぶ。

### 2.1 脅威モデル

まず**脅威モデル(threat model)**を定義する。
脅威モデルは、潜在的な攻撃者、攻撃者の能力とリソース、そして攻撃者の標的を洗い出す。

脅威モデルを構築するときには、より対処しやすい脅威から始めることが重要となる。

#### 2.1.1 一般的な脅威モデル

以下、よく使用されている脅威モデルの定義。  
どの手法にも長所と短所があるので、3 つの手法を組み合わせて使用するのが理想的である。

- [STRIDE](<https://docs.microsoft.com/en-us/previous-versions/commerce-server/ee823878(v=cs.20)>) : 驚異の識別。Spoofing（なりすまし）、Tampering（改竄）、などの頭文字。
- [DREAD](<https://en.wikipedia.org/wiki/DREAD_(risk_assessment_model)>) : リスク評価。Damage potential（潜在的な損害）、Reproductivity（再現可能性）、などの頭文字）
- [PASTA](https://www.oreilly.com/library/view/risk-centric-threat/9780470500965/) : Risk Centric Threat Modeling: Process for Attack Simulation and Threat Analysis。リスク中心モデル。
- [Trike](http://trike.sourceforge.net/home.shtml) : オープンソースの脅威モデリング手法・ツールとのこと。
- [VAST](https://go.threatmodeler.com/threat-modeling) : プロアクティブな脅威モデルとかなんとか。

続けて、攻撃者の能力の分類。  
リスクをどのレベルまで低減するかに議論の焦点を絞るのに役立つ。

1. スクリプトキディ : 標的をあらかじめ定めず、よく知られている脆弱性をツールなどを使って悪用する能力の低い攻撃者。
2. 標的型攻撃者 : 特定の標的に対して特別な攻撃を用意する攻撃者。スピアフィッシングや産業スパイがこのカテゴリに分類される。
3. インサイダー脅威 : ログイン情報を持つ、システムの一般ユーザー。通常は、請負業者や権限を持たない従業員がこのカテゴリに分類される。
4. 信頼されたインサイダー : 強い権限を得ているシステムの管理者。
5. 国家レベルのアクター : 外国政府または自国政府の支援を受け、標的を攻撃するための潤沢な資金と位置特定能力を持つとされる攻撃者。

#### 2.1.2 ゼロトラストの脅威モデル

ゼロトラストネットワークは、セキュリテイ計画を立てるにあたって、[RFC3552](https://tools.ietf.org/html/rfc3552#section-3)のインターネット脅威モデルにおおむね従っている。

ゼロトラストネットワークはネットワーク内のエンドポイントを明示的に制御する。

ゼロトラストネットワークの目標は、あらゆる敵の攻撃を防ぐことではなく、むしろ敵対的なネットワークでよく見られる攻撃者に備えることである。

先の攻撃者の能力に関する議論において、ゼロトラストネットワークが対処できるのは、「4.信頼されたインサイダー」とそれよりも低レベルの攻撃者である。

一般に、ゼロトラストネットワークは国家レベルのアクターに対する緩和対策を試みないが、リモートからのシステムヘの侵入については緩和対策を講じることはできる。

ゼロトラストモデルが満たせるのは「ディスクに格納されたクレデンシャルなど、認証と認可に用いられる情報の安全性だけである」ことを明確にしておくべきである。  
デイスクの完全な暗号化など、エンドポイントに対するさらなる要件は、追加のポリシーを通じて適用すればよい。

### 2.2. 強力な認証

ある人物がどれほど信頼できたとしても、回線の向こう側にいる相手(またはシステム)が、実際に彼らであること証明するのは難しい。

通常、運用者はリモートシステムの IP アドレスの許可やパスワード制とするが、攻撃者はかんたんに入手する。

ゼロトラストネットワークはデータフローの 1 つ 1 つに強力な認証を導入することが非常に重要となる。

認証の実現は X.509 という証明書の規格が有効で、公開鍵、秘密鍵を用いて TLS/SSL 接続を認証する。  
別々の場所に保管された複数の秘密鍵を使用し、それらの組み合わせによつてアクセスを許可することが望ましい。

さらに、すべてのクレデンシャルに有効期限を設定することが不可欠である。  
有効期限により、流出または窃取された鍵の影響範囲を最小限に抑えるのに役立つし、運用者にはシステムの信頼回復の機会が与えられる。  
鍵とパスワードを変更する一一つまり、鍵とパスワードを更新する行為は、クレデンシャルのローテーション(credential rotation)と呼ばれる。

秘密鍵が漏洩していないことを検証し、必要に応じてそれらを無効にするには、クレデンシャルのローテーションが不可欠である。

### 2.3. 公開鍵基盤（PKI）

証明書と公開鍵暗号方式について、証明書だけでは、認証の問題は解決できない。  
公開鍵基盤(PKI)は、信頼されないネットワークにおいて公開鍵の配布と検証を安全に行うための一連の役割と責務を定義する。

PKI の目的は、権限を持たない参加者が、共通の第三者との既存の信頼関係を通じて、相手(ピア)の真正性を検証できるようにすることにある。  
PKI は、アイデンティティ（アイデンティティの詳細は後で出てくる）を公開鍵と結び付けるために、登録機関(RA)と呼ばれるものを利用する。

この結び付きは証明書に埋め込まれ、信頼される第三者によって電子署名される。  
受信者がこの署名付きの証明書を提示することで、アイデンティティを「証明」できるようになる。

PKI プロバイダの種類はさまざまである。  
最もよく知られているのは、認証局(CA)と WoT(Web of Trust)の 2 つである。  
CA が利用するのは証明書チェーンで、このチェーンをたどっていくと、最終的に信頼できる第三者にたどり着く。  
WoT の場合は、信頼を(チェーンではなく)クモの巣のように張り巡らせ、信頼される証明書が見つかるまでたどっていくことで、信頼できることが裏付けられる（PGP(Pretty Good Privacy)）。  
本書では、CA を利用する PKI に焦点を合わせる。

#### 2.3.1. 認証局（CA）とは何か

\*このへんよくわからん。

CA は、証明書チェーンのトラストアンカーの役割を果たす。  
CA は、公開鍵とそれらに結び付けられたアイデンティティに署名し、公開鍵を発行する。  
CA の署名により、権限を持たないエンティティが結び付きの有効性を検証できるようになる。

CA 証明書は、CA 自体のアイデンティティを表すために使用される。  
クライアン卜証明書に署名するために使用されるのは、CA 証明書の秘密鍵である。  
提示されたクライアント証明書の署名を検証するために、CA 証明書は広く公開され、認証する側のエンティティによって使用される。  
クライアントに代わってデジタル証明書を発行し、その有効性を裏付ける信頼された第三者となる。

信頼された第三者という立場はきわめて特権的である。  
CA の崩壊は破滅的な結果をもたらすため、いかなる代償を払ってでも保護されなければならない。  
X.509 のようなデジタル証明書規格を利用すれば、証明書を連鎖させることが可能となり、ルート CA が直接関与せずに済むようになる。  
CA ベースの PKI セキュリテイでは、これが標準的な慣行と見なされている。

#### 2.3.2. ゼロトラストにおける PKI の重要性

すべてのゼロトラストネットワークは、ネットワーク全体でのアイデンティティの証明に PKI を利用する。  
デジタル証明書によって認証されるエンティティには、次のようなものがある。

- デバイス
- ユーザー
- アプリケーション

#### 2.3.3. プライベート PKI とバブリック PKI

パブリック PKI はインターネット全体によつて信頼されるが、ゼロトラストネットワークでの使用は推奨されない。  
パブリック PKI には欠点がいくつかある。

1. コスト : 公的に信頼される機関はお高い。
2. 公的な機関を「完全」に信頼するのが難しい : CA はさまざまな国で運営されており、突然、信頼していた証明書を無効化されるおそれもある。
3. 柔軟性やプログラム化の容易性が損なわれ、自動化が困難となる懸念がある : パブリック CA は自分たちでも高いセキュリティ対策を講じるが、そこに縛られて自社サービスのポリシーと相容れないことがある。

#### 2.3.4. パブリック PKI : ないよりは断然まし

パブリック PKI には上記のような欠点があるため、本書では、ゼロトラストネットワーク内での使用には断固として反対するが、PKI をまったく利用しないよりはましである。

### 2.4. 最小権限

最小権限の原則がある。  
エンティティに付与する権限を、そのエンティティの作業に必要なものだけに限定すべきだという考えである。  
たまーに必要になるアクセス程度では、許可は付与しない。

アクセス権限の昇格が必要なら、そのアクセス権限が必要な期間だけ付与するように運用する。  
適切な権限を付与できるように、どのアクションにどの権限が必要であるかを理解しておくことである。

一般的に、1 台のマシン上でユーザーの権限を昇格するには、ユーザーの認証が必要である。  
たとえば Unix での sudo コマンド。  
GUI 環境では、危険な操作を実行する前にユーザーのパスワードを求めるダイアログボックスが表示されることがある。

ゼロトラストネットワークでも同様となる。  
リスクの低いアクションでは単純なもの。ユーザーパスワードの再入力、2 段階認証トークンの要求、またはユーザーのスマートフォンヘのプッシュ通知など。  
リスクの高いアクシヨンでは、アウトオブバンドのリクエストを通じてピアによる明確な確認を要求するなど。  
ガチでリスク高めなら、複数人の連携を考える。やりすぎると高コストだが。

ユーザーと同様に、アプリケーションについても、ネットワーク上での操作に必要な最低限の権限が付与されるように設定すべきである。

ゼロトラストネットワークで付与される権限のレベルは、ユーザーまたはアプリケーションと、使用されるデバイスの組み合わせによって決まる。  
これにより、クレデンシャルの紛失や不正使用の影響を低減できる。

ゼロトラストネットワークでの権限は、従来のネットワークと比べて動的である。

従来のネットワークは最終的に比較的動きのない(静的な)ポリシーに収束する。  
静的なポリシー定義には、次の 2 つの問題がある。

1. 寛容な組織では権限が徐々に拡大していき、最小権限のメリットが減少していくことである。
2. システム管理者により大きなアクセス権限が与えられる。  
   結果として、システム管理者は悪意を持つアクターによるフイッシング攻撃の標的となっている。

ゼロトラストネットワークでは、ネットワーク上のアクティビティのさまざまな属性を参照し、現在要求されているアクセスの危険度が特定される。  
属性とは以下のような情報となる。

- 時間的なもの : そのユーザーの通常の活動時間帯から外れるアクセスはより疑わしい
- 地理的なもの : ユーザーが前回とは異なる場所からアクセスしている
- 行動に関するもの : ユーザーが普段アクセスしないリソースにアクセスしている

すべての詳細を検証することで、単純な「イエス/ノー」よりも細かく判断できる。

この機能は、ゼロトラストネットヮークの安全性を高める機能の 1 つである。  
ポリシーやアクセスを動的に調整することで、悪意を持つアクターによる既知の攻撃や未知の攻撃に自律的に対処することができる。
