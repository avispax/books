---
tags: tech
title: ゼロトラストネットワーク -境界防御の限界を超えるためのセキュアなシステム設計
author: Evan Gilman
page: 304
---

# 0. はじめに

本書では、一連のデザインパターンや考慮事項を取り上げている。

デザインパターンや考慮事項をまとめたのがゼロトラストモデルと呼ばれるものである。  
このモデルを導入すれば、横断的侵害、VPN の問題、一元的なファイアウォールの管理の負担が実質的に取り除かれる。

## 0.1. 本書の対象読者

ネットワークエンジニア、セキュリティエンジニア、CTO、そしてそれ以外のすべての人が、ゼロトラストを学ぶことから恩恵を受ける。

## 0.2. 本書を執筆した理由

本書の目的は、通信ネットワークを信頼しないシステムモデルを定義することにある。  
特定のソフトウェアや実装に焦点を合わせるのではなく、ゼロトラストネットワークを構築するための概念や原理を取り上げる。  
独自のシステムを構築するときに、この種のシステムを構築する方法が明確にイメージできるようになることを願っている。  
さらに、本書で説明する問題への再利用可能なソリューションも提供したいと考えている。

参考 : Google の[BeyondCorp](https://cloud.google.com/beyondcorp?hl=ja)

## 0.3. 現在のゼロトラストネットワーク

ゼロトラストモデルは Forrester の John Kindervag によって 2010 年に考案された。

現在のゼロトラストネットワークは、市販のソフトウェアコンポーネントと、それらのコンポーネントを斬新な方法で統合するカスタムソフトウェアとグルー(接着剤)を使って構築されている。  
本書を読むときには、ゼロトラストネットワークの実装が(まだ)ハードウェア製品やソフトウェア製品のインストールと設定のような簡単なものではないことに注意してほしい。

# 1. ゼロトラストの基礎

データセンター内のシステムやトラフィックは信頼できるという前提は間違っている。  
ホストやリンクが 1 つでも不正に侵入されれば、「セキュア」なインフラストラクチャ内を自由に移動することがいとも簡単にできてしまう。

ネットワークに信頼を置かなくても、ネットワーク通信を効率的にセキュアにすることは可能だ。

## 1.1. ゼロトラストネットワークとは何か

5 つの基本的な原則がある。

- ネットワークは常に安全ではないと見なされる。
- ネットワーク上には外部および内部の脅威が常に存在する。
- ネットワークを信用できると判断するには、ローカルネットワークでは不十分である。
- デバイス、ユーザー、ネットワークフローは 1 つ残らず認証および認可される。
- ポリシーは動的であり、できるだけ多くの情報源に基づいて作成されなければならない。

従来のネットワークセキュリティアーキテクチャは、ネットワーク(またはサブネット)をゾーンに分割し、1 つ以上のファイアウォールで侵入を食い止めている。（図 1-1）  
各ゾーンには何らかの信頼レベルが割り当てられ、それにより、どのネットワークリソースヘのアクセスが許可されるのかが決まる。  
このモデルは非常に強力な多層防御をもたらす。

ただし、現代のサイバー攻撃には力不足である。

アクセス制御の適用箇所(ポリシーエンフォースメント)を分散させ、ゼロトラストの原則を適用すると、図 1-2 のような設計が可能となる。

### 1.1.1. ゼロトラストコントロールプレーン

サポーティングシステムは**コントロールプレーン(control plane)**と呼ばれる。  
それ以外のほとんどのものは**データプレーン(data plane)**と呼ばれ、コントロールプレーンによって管理される。  
保護されているリソースヘのアクセスリクエストは、まずコントロールプレーンに送信される。  
コントロールプレーンでは、デバイスとユーザーの両方が認証および認可されなければならない。

コントロールプレーンは、「リクエストを許可できる」と判断すると、送信元のクライアントからのトラフイック(のみ)を受け入れるようにデータプレーンを動的に設定する。

適用したいアクセス制御の強度について、信用できるデータプレーンに対し、さまざまな入力に基づいて認証、認可、アクセスをリアルタイムに調整する権限を与える、というのが基本的な考え方である。

## 1.2. 境界モデルの進化

従来のアーキテクチャは**境界モデル(perimeter model)**と呼ばれる。  
侵入者は、境界線を突破しなければデータにアクセスできない。  
残念ながら、近年の環境では、もはや十分ではない。  
以下、歴史。

- 最初期はグローバル IP のみだった。（1.2.1. グローバル IP アドレス空間の管理）
- グローバルだけだとあれなので、プライベート IP アドレスが誕生した。セキュリティはまだなかった。（1.2.2. プライベー卜 IP アドレス空間の誕生）
- 外部とのやり取り用にメールサーバーぐらいが配置された。境界モデルの誕生である。（1.2.3. プライベートネットワークからパブリックネットワークヘの接続）
- メールだけだとあれで、NAT が活用された。実質ファイアウォール。（1.2.4. NAT の誕生）
- 境界となる場所を厳重にセキュリティ制御しよう。（1.2.5. 現代の境界モデル）

## 1.3. 潜在的な脅威の進化

NAT は内から外に行く分には緩いので、マルウェアによる攻撃が主流となった。  
境界の内側に潜り込めたら横断的侵害はチョロい。

## 1.4. 境界モデルの弱点

マルウェアによる横断的侵害の実例。

ネットワークセキュリティに関して考えられる最善のモデルは 信用 である。

## 1.5. 信用の在りか

ゼロトラストモデルは、その名のとおり、ネットワークを盲目的に信頼しないモデルである。

ホストが属しているネットワークは危険にさらされており、安全ではないと見なさなければならない。

## 1.6. 成功要因としての自動化

セキュリティポリシーを動的に更新して適用することが必要なので、自動化が必須となる。

## 1.7. 境界とゼロトラスト

境界モデルとゼロトラストモデルは根本的に異なっている。  
境界モデルは、信頼されるリソースと信頼されないリソース(言い換えれば、ローカルネットワークとインターネット)の間に壁を築こうとする。  
これに対し、ゼロトラストモデルは基本的に負けを認め、「悪人」はどこにでもいるという現実を受け入れる。

ゼロトラストネットワークは、以下の 3 つの重要な要素で構成される。

- ユーザー/アプリケーション認証  
   すべてのアクションがユーザーによって実行されるわけではないため、二重性を示している。  
   (データセンターの内部など)自動化されたアクションの場合は、普段ユーザーの属性を調べるのと同じような方法で、アプリケーションの属性を調べることになる。

- デバイス認証
- 信用

補足 : 上の 3 つは後の章で詳解される。

境界モデルの欠点は、全体的な保護に欠けていることにある。

ゼロトラストモデルは、セキュリティを強化すればするほど、利便性が高くなる。

## 1.8. クラウドヘの適用

ゼロトラストモデルは、現状まるで信用できないパブリッククラウド環境にこそ最適である。

## 1.9. まとめ

本章では、ゼロトラストモデルの概念を取り上げた。
ゼロトラストモデルは、内部ネットヮークを盲目的に信頼する境界モデルを排除する。
代わりに、境界モデルが失敗する運命にあることを認め、結果として、悪意を持つ者が内部ネットワークの中にいると前提することから始める。
そして、この脅成を防ぐためのセキュリティ対策を構築する。

境界モデルが不十分である理由をよく理解するために、境界モデルがどのようにして誕生したのかについて説明した。
インターネットが始まったばかりの頃、ネットワークは完全にルーティング可能だった。
システムが進化すると、インターネット上でルーティングされる必要性のないネットワークの領城が一部のユーザーによって特定され、プライベートネットワークの概念が生まれた。
この考えが徐々に根付いていくと、組織は信頼されるプライベートネットワークの保護を中心としてセキュリテイをモデル化した。
残念ながら、時が経つにつれプライベートネットワークは初期ほど隔離されているとは言えなくなった。
結果として、境界は穴だ聰けで、通常のセキュリテイインシデントで頻繁に突破されるようになった。

境界ネットワークについて共通の理解を得たところで、その設計をゼロトラストモデルと対比させることができた。
ゼロトラストモデルはシステムを信用するまで注意深くチェックする。
こうした種類のネットヮークでは、より動的で堅牢なシステムを作成できるセキュリテイ制御システムを現実的に管理するために、自動化が必要である。
そこで、ユーザー、デバイス、アプリケーションの認証と、それらのコンポーネントの組み合わせに対する認可など、重要な概念をいくつか紹介した。
本書ではこれ以降、これ場の概念を詳しく見ていくことにする。

最後に、パブリッククラウド環境への移行と、インターネット接続の普及により、脅威が根本的に変化していることに言及した。
「内部」ネットワークはクラウド環境を経由することで、すっかり抽象化されてしまった。
このため、より脆弱な長距離ネットワークリンクでデータが転送されていたとしても、エンドユーザーはそのことに気づかない。
こうした変化により、結果的に、新しいシステムを構築するにあたつてデータセキュリテイの重要性はかつてないほど高まっている。

# 2. 信頼と信用の管理

信頼と信用の管理はゼロトラストネットワークの最も重要な構成要素である。

信頼、信用とはなにか。けっきょく、私（運用者が）その人を知ってる/知らない だ。

ゼロトラストネットワークでの信頼は常に運用者から始まる。

信頼にお墨付きを与え、信頼を付与する運用者が常に勤務中とは限らない。

信頼されている運用者がシステムにある程度の信頼を割り当て、そのシステムが自動で行った作業を信用する。（信用の委任）

オートスケーリングはその一例である。  
サーバーを必要に応じて自動的に構築したいが、新しいサーバーが、他の適当に立てられた管理されないサーバーではないことはどうすればわかるか。  
構築システムを自作するのだ。それで自作されたサーバーはつまり自分のやつだ。

このような流れはトラストチェーン(trust chain)と呼ばれる。  
そして、運用者をトラストアンカーと呼ぶ。

## 2.1 脅威モデル

まず**脅威モデル(threat model)**を定義する。
脅威モデルは、潜在的な攻撃者、攻撃者の能力とリソース、そして攻撃者の標的を洗い出す。

脅威モデルを構築するときには、より対処しやすい脅威から始めることが重要となる。

### 2.1.1 一般的な脅威モデル

以下、よく使用されている脅威モデルの定義。  
どの手法にも長所と短所があるので、3 つの手法を組み合わせて使用するのが理想的である。

- [STRIDE](<https://docs.microsoft.com/en-us/previous-versions/commerce-server/ee823878(v=cs.20)>) : 驚異の識別。Spoofing（なりすまし）、Tampering（改竄）、などの頭文字。
- [DREAD](<https://en.wikipedia.org/wiki/DREAD_(risk_assessment_model)>) : リスク評価。Damage potential（潜在的な損害）、Reproductivity（再現可能性）、などの頭文字）
- [PASTA](https://www.oreilly.com/library/view/risk-centric-threat/9780470500965/) : Risk Centric Threat Modeling: Process for Attack Simulation and Threat Analysis。リスク中心モデル。
- [Trike](http://trike.sourceforge.net/home.shtml) : オープンソースの脅威モデリング手法・ツールとのこと。
- [VAST](https://go.threatmodeler.com/threat-modeling) : プロアクティブな脅威モデルとかなんとか。

続けて、攻撃者の能力の分類。  
リスクをどのレベルまで低減するかに議論の焦点を絞るのに役立つ。

1. スクリプトキディ : 標的をあらかじめ定めず、よく知られている脆弱性をツールなどを使って悪用する能力の低い攻撃者。
2. 標的型攻撃者 : 特定の標的に対して特別な攻撃を用意する攻撃者。スピアフィッシングや産業スパイがこのカテゴリに分類される。
3. インサイダー脅威 : ログイン情報を持つ、システムの一般ユーザー。通常は、請負業者や権限を持たない従業員がこのカテゴリに分類される。
4. 信頼されたインサイダー : 強い権限を得ているシステムの管理者。
5. 国家レベルのアクター : 外国政府または自国政府の支援を受け、標的を攻撃するための潤沢な資金と位置特定能力を持つとされる攻撃者。

### 2.1.2 ゼロトラストの脅威モデル

ゼロトラストネットワークは、セキュリティ計画を立てるにあたって、[RFC3552](https://tools.ietf.org/html/rfc3552#section-3)のインターネット脅威モデルにおおむね従っている。

ゼロトラストネットワークはネットワーク内のエンドポイントを明示的に制御する。

ゼロトラストネットワークの目標は、あらゆる敵の攻撃を防ぐことではなく、むしろ敵対的なネットワークでよく見られる攻撃者に備えることである。

先の攻撃者の能力に関する議論において、ゼロトラストネットワークが対処できるのは、「4.信頼されたインサイダー」とそれよりも低レベルの攻撃者である。

一般に、ゼロトラストネットワークは国家レベルのアクターに対する緩和対策を試みないが、リモートからのシステムヘの侵入については緩和対策を講じることはできる。

ゼロトラストモデルが満たせるのは「ディスクに格納されたクレデンシャルなど、認証と認可に用いられる情報の安全性だけである」ことを明確にしておくべきである。  
デイスクの完全な暗号化など、エンドポイントに対するさらなる要件は、追加のポリシーを通じて適用すればよい。

## 2.2. 強力な認証

ある人物がどれほど信頼できたとしても、回線の向こう側にいる相手(またはシステム)が、実際に彼らであること証明するのは難しい。

通常、運用者はリモートシステムの IP アドレスの許可やパスワード制とするが、攻撃者はかんたんに入手する。

ゼロトラストネットワークはデータフローの 1 つ 1 つに強力な認証を導入することが非常に重要となる。

認証の実現は X.509 という証明書の規格が有効で、公開鍵、秘密鍵を用いて TLS/SSL 接続を認証する。  
別々の場所に保管された複数の秘密鍵を使用し、それらの組み合わせによつてアクセスを許可することが望ましい。

さらに、すべてのクレデンシャルに有効期限を設定することが不可欠である。  
有効期限により、流出または窃取された鍵の影響範囲を最小限に抑えるのに役立つし、運用者にはシステムの信頼回復の機会が与えられる。  
鍵とパスワードを変更する一一つまり、鍵とパスワードを更新する行為は、クレデンシャルのローテーション(credential rotation)と呼ばれる。

秘密鍵が漏洩していないことを検証し、必要に応じてそれらを無効にするには、クレデンシャルのローテーションが不可欠である。

## 2.3. 公開鍵基盤（PKI）

証明書と公開鍵暗号方式について、証明書だけでは、認証の問題は解決できない。  
公開鍵基盤(PKI)は、信頼されないネットワークにおいて公開鍵の配布と検証を安全に行うための一連の役割と責務を定義する。

PKI の目的は、権限を持たない参加者が、共通の第三者との既存の信頼関係を通じて、相手(ピア)の真正性を検証できるようにすることにある。  
PKI は、アイデンティティ（アイデンティティの詳細は後で出てくる）を公開鍵と結び付けるために、登録機関(RA)と呼ばれるものを利用する。

この結び付きは証明書に埋め込まれ、信頼される第三者によって電子署名される。  
受信者がこの署名付きの証明書を提示することで、アイデンティティを「証明」できるようになる。

PKI プロバイダの種類はさまざまである。  
最もよく知られているのは、認証局(CA)と WoT(Web of Trust)の 2 つである。  
CA が利用するのは証明書チェーンで、このチェーンをたどっていくと、最終的に信頼できる第三者にたどり着く。  
WoT の場合は、信頼を(チェーンではなく)クモの巣のように張り巡らせ、信頼される証明書が見つかるまでたどっていくことで、信頼できることが裏付けられる（PGP(Pretty Good Privacy)）。  
本書では、CA を利用する PKI に焦点を合わせる。

### 2.3.1. 認証局（CA）とは何か

\*このへんよくわからん。

CA は、証明書チェーンのトラストアンカーの役割を果たす。  
CA は、公開鍵とそれらに結び付けられたアイデンティティに署名し、公開鍵を発行する。  
CA の署名により、権限を持たないエンティティが結び付きの有効性を検証できるようになる。

CA 証明書は、CA 自体のアイデンティティを表すために使用される。  
クライアン卜証明書に署名するために使用されるのは、CA 証明書の秘密鍵である。  
提示されたクライアント証明書の署名を検証するために、CA 証明書は広く公開され、認証する側のエンティティによって使用される。  
クライアントに代わってデジタル証明書を発行し、その有効性を裏付ける信頼された第三者となる。

信頼された第三者という立場はきわめて特権的である。  
CA の崩壊は破滅的な結果をもたらすため、いかなる代償を払ってでも保護されなければならない。  
X.509 のようなデジタル証明書規格を利用すれば、証明書を連鎖させることが可能となり、ルート CA が直接関与せずに済むようになる。  
CA ベースの PKI セキュリティでは、これが標準的な慣行と見なされている。

### 2.3.2. ゼロトラストにおける PKI の重要性

すべてのゼロトラストネットワークは、ネットワーク全体でのアイデンティティの証明に PKI を利用する。  
デジタル証明書によって認証されるエンティティには、次のようなものがある。

- デバイス
- ユーザー
- アプリケーション

### 2.3.3. プライベート PKI とバブリック PKI

パブリック PKI はインターネット全体によつて信頼されるが、ゼロトラストネットワークでの使用は推奨されない。  
パブリック PKI には欠点がいくつかある。

1. コスト : 公的に信頼される機関はお高い。
2. 公的な機関を「完全」に信頼するのが難しい : CA はさまざまな国で運営されており、突然、信頼していた証明書を無効化されるおそれもある。
3. 柔軟性やプログラム化の容易性が損なわれ、自動化が困難となる懸念がある : パブリック CA は自分たちでも高いセキュリティ対策を講じるが、そこに縛られて自社サービスのポリシーと相容れないことがある。

### 2.3.4. パブリック PKI : ないよりは断然まし

パブリック PKI には上記のような欠点があるため、本書では、ゼロトラストネットワーク内での使用には断固として反対するが、PKI をまったく利用しないよりはましである。

## 2.4. 最小権限

当たり前だが、エンティティに付与する権限は、そのエンティティの作業に必要なものだけに限定すべきだ。

適切な権限を付与できるように、どのアクションにどの権限が必要であるかを理解しておくことである。

リスクが低いアクションでは単純な認証（ユーザーパスワードの再入力など）で対応する。  
リスクが高いアクシヨンでは、アウトオブバンドのリクエストを通じてピアによる明確な確認を要求するなど。  
さらにリスク高めなら、複数人の連携を考える。やりすぎると高コストだが。

ユーザーと同様に、アプリケーションについても、ネットワーク上での操作に必要な最低限の権限が付与されるように設定すべきである。

ゼロトラストネットワークで付与される権限のレベルは、ユーザーまたはアプリケーションと、使用されるデバイスの組み合わせをチェックして動的に決まる。

ちなみに従来のネットワークは最終的に比較的動きのない(静的な)ポリシーに収束するが、次の 2 つの問題がある。

1. 寛容な組織では権限が徐々に拡大していき、最小権限と言えなくなる。
2. システム管理者により大きなアクセス権限が与えられる。

ゼロトラストネットワークでは、以下のような属性を参照し、危険度を動的に特定する。

- 時間的なもの : そのユーザーの通常の活動時間帯から外れるアクセスはより疑わしい
- 地理的なもの : ユーザーが前回とは異なる場所からアクセスしている
- 行動に関するもの : ユーザーが普段アクセスしないリソースにアクセスしている

ポリシーやアクセスを動的に調整することで、悪意を持つアクターによる既知の攻撃や未知の攻撃に自律的に対処することができる。

## 2.5 変化する信頼と信用

信用を管理する必要があるが、それっておそらく最も難しい。

まず信頼に関係するポリシーの定義・割り当ては、一般にセキュリティエンジニアが手動で行うものとされている。
多くの組織では職務や役割ベースのポリシーが割り当てられるが、ネットワークのシステム管理者に信頼が集中することや、組閣が柔軟ではないため、よろしくない。

アクターと信頼の関係を見つめ直そう。
ネットワークでの信頼が常に進化していて、ネットワーク内でのアクターの過去と現在のアクションに基づいていることを認識するほうが建設的かもしれない。

上記のようなネットワーク内の信頼に加えて、信用スコアってのを定義する(p.44 図 2-3)。
ネットワーク上でのアクターのアクションを絶えずモニタリングと検証することで、アクターの信用スコアを更新する。
そして、この信用スコアをもとに、その信用に対する違反のインパクトに基づいてネットワークのポリシーを定義すればよい(図 2-4)。

セッションを開始した時点では、クライアントは信用されていない。
会社指定の PC を使用する、会社指定のドングルを使用するなどで、最低限の環境を揃えていく（＝信用ポイントを獲得していく）ことで、ネットワークに参加できる。

ただし問題もある。
スパイ野郎はちゃんとしたメンバーを長期間演じることで、この辺を突破してくることもある。
これはもう、長期間演じさせることで攻撃を遅延させておく。

それに加え、機密性の高いオペレーションヘのアクセスを、信用される場所と人物に限定できるようにしておく。コントロールプレーンで。
信用スコアをデバイスやアプリケーションのメタデータに結び付ければ、絶対条件を宣言すると同時に、計算された信用スコアを通じて未知の未知をカバーできる柔軟なポリシーを実現することが可能となる。

まぁでもめんどくさがられるだろうけど、どうするかは自由。

## 2.6 コントロールプレーンとデータプレーン

データプレーンはいろんなシステムと絡む用のやつ。
コントロールプレーンは信用スコア計算とか。データプレーンに指示も出したりするよ。

データプレーンとコントロールプレーンは疎結合にして、非パブリック PKI システムを使って暗号化・認証されなければならない。

実装は、アクセストークンの発行か、有効期限の短い証明書を使用するのが最適である。
発行されたアクセストークンは、データプレーンの内部だけでなく、データプレーンとコントロールプレーン間のプロセス内でも検証されるべきである。

# 3. ネットワークエージェント

## 3.1. エージェントとはなにか

ネットワークエージェントとは、ネットワークリクエストをするエンティティ（デバイス、ユーザー、アプリケーション）それぞれのデータを組み合わせることをいう。

従来は、それぞれのエンティティが別々に権限を付与されていたが、ゼロトラストネットワークは、リクエストに参加するすべての要素の組み合わせとしてポリシーを定義する。

ネットワークエージェントについては、ポリシーを評価するために、必要に応じて形成される一時的な組み合わせのことと捉えてよい。
データを取得する時点でのそういった組み合わせをエージェントと呼ぶ。

### 3.1.1. 揮発性なエージェント（原題「Agent Volatility」 = すげぇ頻度で更新されるエージェント、的な内容だった。「揮発性」じゃわかんねぇよ）

エージェントを構成しているフイールドは、IT 組織が通常想定する頻度よりもかなり頻繁に変化する。
新型の攻撃に対抗するには、信用スコアをリアルタイムに近い頻度で更新する必要がある。

ネットワークエージェントは、スパースなデータ(成分のほとんどが 0 のまばらなデータ)を持つことがよくある。
起動中のデバイスや、自動処理データは、稼働中のデバイスよりもエージェントのデータが少ないはずなので、ユーザーデータが混入されるのは怪しい。
というようなシナリオを想定し、認可ポリシーに反映させる必要がある。

### 3.1.2. エージェントには何が含まれているか

エージェントに含まれているデータの粒度は、ニーズゃ成熟度に基づいて異なる。

以下、例。

- エージェントの信用スコア
- ユーザーの信用スコア
- ユーザーのロールまたはグループ
- ユーザーの居住地
- ユーザーの認証方式
- デバイスの信用スコア
- デバイスのメーカー
- TPM(TrustedPlatformModue)のメーカーとバージョン
- デバイスの現在の位置
- IP アドレス

## 3.2 エージェントはどのように使用するか

ゼロトラストネットワークでは、実際に認可されるのはエージェント（前述 3.1）である。
エージェントを認可するために、ポリシーもエージェント用の定義となる。

エージェントはネットワークの主要なエンティティであり、信用スコアの計算にも使用される。
信用スコアはエージェントの追加属性として提供される。

### 3.2.1 認証には使用されない

エージェントは認可コンポーネントであり、認証にはいっさい関与しない。
認証は別の問題であり、認証状態はエージェントの属性に反映される。

一般に、認証はセッションごとに実施され、認可はリクエストごとに実施する。
認可の判断に使用されるエージェントの情報はさまざまな要因に基づいて目まぐるしく変化するので、最新のデータを使用するのが望ましい。

## 3.3 エージェントにはどのようにアクセスするか

その前に、ネットワークエージェントは詳細な認可の判断のために、機密情報、個人情報を含む可能性があるので、慎重に扱ってね。

機密情報も絡むので、エージェントは信頼されるコントロールプレーンシステムに含め、そこでエージェントのライフサイクル全体を管理・保護する。
ちなみに前述の通りコントロールプレーンはデータプレーンと疎結合ね。

管理・保護されたエージェントデータは、そのままコントロールプレーンでアクセス可能とする。

一部の情報にはデータプレーンからアクセスできるようにする。

データプレーンに存在するアプリケーションが詳細な認可ロジックを独自に実装できるようにするには、信頼される通信チャネルを通じてエージェントの情報にアクセスできるようにすればよい。

ダウンストリームアプリケーシヨンにエージェントのデータを提供することは、高度な認可システムを持つ既存のアプリケーションとの互換性を維持する上でも有益である。
この互換性という目的により、エージェントの情報をアプリケーシヨンにとつて望ましいフォーマットで提供すべきであることが浮き彫りとなる。

## 3.4 標準は存在しない

ゼロトラストネットワークの管理はまだ非常に新しい概念であり、ネットワークエージェントのための標準はまだ存在しない。
本書の執筆時点では、ほとんどのゼロトラストネットワークが自社開発されたシステムで構成されている。

### 3.4.1 厳格さと流動性の両立

エージェントの実装（設計）と管理は、厳格に、かつ流動性・互換性をもたせてね、という、まぁ当たり前のことを言っていた。

### 3.4.2 望まれる標準化

SNMP(SimpleNeb″orkManagementProtocol)とそれに関連する MIB(ManagementlnformationBase)が使えそうだよ。

### 3.4.3 標準化されるまではどうするか

とりあえず実装者のニーズに基づく無難な形式か、いっそのこと型とかは指定しないほうが望ましい。

# 4. 認可の判断

## 4.1 認可アーキテクチャ

ゼロトラストの認可アーキテクチャは、4 つの主要なコンポーネントで構成される(p.64 図 4-1)。

- エンフォーサ（エンフォースコンポーネント）
- ポリシーエンジン
- トラストエンジン
- データストア

## 4.2 エンフォーサ(p.66 図 4-2)

エンフォーサは認可フローの「最前線」に位置し、エージェントに対して他システムの判断を適用する。

エンフォーサの主な責務は 2 つ。

1. ポリシーエンジンとのやり取り
2. 判断の実際の導入と継続的な適用

ポリシーエンジンが通知を受けるのはリクエストが発生する前かもしれないし、そのリクエストの処理中かもしれない。
どのアーキテクチャを選択するか適宜考えろ。

エンフォーサの配置は非常に重要である。
エンフォーサとデータプレーンはできるだけ近くに配置し、改ざんを防ごう。

## 4.3 ポリシーエンジン

ポリシーエンジンは認可の判断を計算する重要なシステムである。
認可は、利用可能なデータと、システム管理者によって作成されたポリシー定義に基づいて行われる。

ポリシーエンジンは、エンフォーサから送信されてくるリクエストをポリシーと比較し、認可判定する。
この判断の結果はエンフォーサに返され、そこで実際に適用される。

ポリシーエンジンとエンフォーサは並べて配置したり別々に配置したりできる。

並べるとリクエストを認可するための遅延が小さくなる。
遅延が少ないと、通常のセッションレベルの認可ではなく、HTTP リクエストごとの認可も可能である。

エンフォーサはユーザーのデータパス上にあるため、攻撃にさらされる可能性が高い。
なので、ポリシーエンジンとエンフォーサはプロセスレベルで切り離しておくのと効果的。

### 4.3.1 ポリシーストレージ

ポリシーエンジンによって参照されるルールはバージョン管理システムに格納するのが理想的であり、次のようなメリットがある。

- ポリシーの変更履歴を管理できる。
- ポリシー変更の経緯をバージョン管理システムでトラックできる。
- ポリシー適用時の期待される動作を実際のエンフォーサに対してテストできる。

### 4.3.2 よいポリシーの特徴

ゼロトラストネットワークでは、当然、きめの細かいポリシーがよいとされている。
ポリシーの粒度の目標となるのは、保護の対象となる個々のリソースに範囲を絞ったポリシーである。
ネットワークに存在する次のような論理コンポーネントの観点からポリシーを定義するのが最も効果的である。

- ネットワークサービス
- デバイスエンドポイントクラス
- ユーザーロール

ゼロトラストネットワークのポリシーには、未知の攻撃ベクトルを予測するために信用スコアも使用する。（次節）

ただし、ポリシーを信用スコアだけに依存させるのは禁物であり、認可対象のリクエストの特徴をポリシー定義の一部として使用することもできる。
たとえば、特定のサービスヘのアクセスを特定のユーザーロールにのみ許可することが考えられる。

### 4.3.3 ポリシーを定義するのは誰か

認可ポリシーは細かく定義されたものでなければならないが、細かいと維持するシステム管理者に負担がかかる。
ほとんどの組織はポリシー定義をいくつかのチームに分担させ、各チームが担当するサービスのポリシーを管理できるようにしている。

## 4.4 トラストエンジン

トラストエンジンは、ゼロトラストネットワークにおいて特定のリクエストやアクションに対するリスク分析を行うシステムである。
このシステムは、特定のリクエスト/アクシヨンを許可することの危険度を定量的に評価し、数値化する。
ポリシーエンジンは、最終的な認可の判断にこのスコアを使用する。

トラストエンジンは、このスコアの処理中に、信頼されるインベントリシステムに含まれているエンティティの属性データを頻繁に取り出す。
デバイスのチェックが最後に実施された日時や、特定のハードウェアセキュリテイ機能の有無などの情報である。

定量的なリスク評価の単純な方法は、エンティティの危険度にルールを割り当てることである。
たとえば、最新のソフトウェアパッチが適用されていないデバイスのスコアは減点する。
認証に繰り返し失敗しているユーザーの信用スコアも減点する、など。

ただし、静的に定義された一連のルールでは予想外の攻撃に備えることはできないため、機械学習モデルも導入する。

### 4.4.1 スコア化すべきエンティテイ

どのコンポーネントをスコア化すればよいのだろうか。
エンティティ(ユーザー、デバイス、アプリケーション)ごとにスコアを計算すべきだろうか。
ネットワークエージェント全体に対してスコアを計算すべきだろうか。
それとも、両方のスコアを計算すべきだろうか。
場合によるよね。

ネットワークを介して攻撃されている場合ネットワークエージェントだし、怪しい人間がいる場合はエンティティだ。

ポリシーの定義時に検討するスコアがこれだけあると、ポリシー作成タスクの難易度が上がり、エラーが起きやすくなる。

### 4.4.2 危険と見なされるスコアの公開

エンドユーザーには、自身のスコアをたまに連絡し、警戒度を示してもよい。
見てますよ、的な。
もちろんルールは内緒だ。

## 4.5 データストア

認可の判断に使用されるデータストアは、信頼できるデータソースであり、認可の判断に使用できる現在のデータと過去のデータを格納している。(p.75 図 4-4)。

データは、トラストエンジンによって信用スコアを生成するために使用される。
そして信用スコアはポリシーエンジンで判定に使用される。

データはネットワークの状態に関する信頼できるデータを必要としているシステムでも使用される。

ゼロトラストネットワークは、役割別に分類された多くのデータストアを持つ傾向にある。
データストアは主にインベントリと履歴の 2 種類に分類される。

インベントリは一貫したデータストアであり、対象となるリソースの現在の状態を記録する。
ユーザー情報やデバイスなど。

履歴データストアでは、リスク分析が主な目的となる。
履歴データストアは、特定のリクエストやアクションに関連するリスクを評価するために、最近または過去の振る舞いやパターンを調べるのに役立つ。
このデータを利用する可能性が最も高いのはトラストエンジンである。

# 5. デバイスの信頼と信用

セキュリテイ対策の成否を決めるのはデバイスである。
ほとんどの被害は、信頼していたデバイスに攻撃者が何らかの方法でアクセスできるようになることから始まる。
そのようなアクセスが可能になったが最後、そのデバイスがいくら自身の安全性を訴えたとしても、それを信じるわけにはいかなくなる。

ネットワークにデプロイされるデバイスに対して十分な信憑性を確保するには、さまざまなシステムやプロセスを導入する必要がある。
本章では、そうしたシステムやプロセスを取り上げ、「デバイスを本当に信用できるようにする」というより大きな目標において、それぞれのシステムがどのような役割を果たすのかに着目する。

## 5.8 まとめ

本章では、システムがデバイスをどのように信用できるかに着目した。
この問題は思いのほか難しく、デバイスの信用が検証されるようにするには、さまざまな技術やプラクテイスを適用する必要がある。

まず、人間の運用者がデバイスにどのように信頼を注入するのかについて説明した。
比較的静的なシステムでは、重要なクレデンシャルを人に提供させることがある。
しかし、動的なインフラストラクチヤでは、このプロセスを委任する必要がある。
そうしたクレデンシャルには途方もない価値があるため、そうした情報を安全に扱う方法について説明した。

デバイスは最終的にネットワークの一部となるため、デバイスをどのように認証させるのかを理解することが重要である。
そこで、X.509 や TPM など、ネットワーク上のデバイスの認証に使用できるさまざまな技術を取り上げた。
これらのテクノロジを想定されるインベントリのデータベースと組み合わせて使用すると、デバイスに信用を与える抑制と均衡の実現に大きく役立つことがある。

信用ははかないものであり、時間とともに失われていく。
そこで、信用を更新するメカニズムについても説明した。
さらに、デバイスの信用を測定するために継続的に利用できるさまざまなサインについても説明した。
おそらく最も重要な教訓は、デバイスが信用される状態から始まり、徐々に信用を失っていくことだろう。
デバイスの信用が失われるペースをコントロールしたいところである。

次章では、ゼロトラストシステムのユーザーに信用を確立する方法について見ていく。

| aaa | bbb |
| :-- | :-- |
| aaa | bbb |
|     | ccc |
|     | ddd |
|     | eee |
|     | fff |
|     | ggg |
